{"ast":null,"code":"import _slicedToArray from\"/Users/jacklunceford/Desktop/quiplash_drawing_game/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useEffect,useState}from'react';import socket from\"../socketConfig\";import firebase from'../firebase.js';function Vote(props){var _this=this;var code=useState(props.location.state.code);var name=useState(props.location.state.name);var _useState=useState([]),_useState2=_slicedToArray(_useState,2),pictures=_useState2[0],setPictures=_useState2[1];var round=useState(props.location.state.round);var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),resultTime=_useState4[0],setResultTime=_useState4[1];var groupSize=useState(props.location.state.groupSize);var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),vote=_useState6[0],setVote=_useState6[1];var inputRef=useRef(null);useEffect(function(){var db=firebase.firestore();db.collection(\"rooms\").where(\"code\",\"==\",_this.state.code).collection(\"rounds\").where(\"round\",\"==\",round).collection(\"pictures\").get().then(function(querySnapshot){querySnapshot.docs.forEach(function(doc){setPictures(function(pictures){return pictures.concat(doc.data().dataURL);});});});var numVotes=0;socket.on(\"vote\",function(){numVotes++;if(numVotes==groupSize){setResultTime(true);}});var interval=setInterval(function(){setTime(function(time){return time-1;});if(time==0){clearInterval(interval);setResultTime(true);}},1000);},[]);updateVote=function updateVote(event){setVote({vote:event.target.value});};submitVote=function submitVote(){var votedPicture=pictures[vote];var db=firebase.firestore();db.collection(\"rooms\").where(\"code\",\"==\",code).collection(\"rounds\").where(\"round\",\"==\",round).collection(\"pictures\").where(\"dataURL\",\"==\",votedPicture).update({votes:firebase.firestore.FieldValue.increment(1)}).then(function(){db.collection(\"rooms\").where(\"code\",\"==\",code).collection(\"rounds\").where(\"round\",\"==\",round).collection(\"pictures\").where(\"dataURL\",\"==\",votedPicture).get().then(function(doc){db.collection(\"rooms\").where(\"code\",\"==\",code).collection(\"players\").where(\"name\",\"==\",doc.data().artist).update({votes:firebase.firestore.FieldValue.increment(1)}).then(function(){socket.emit(\"vote\",code);});});});};getWord=function getWord(){var db=firebase.firestore();db.collection(\"rooms\").where(\"code\",\"==\",code).collection(\"rounds\").where(\"round\",\"==\",round).get().then(function(doc){return doc.data().word;});};return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h1\",null,getWord),pictures.map(function(idx,picture){return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"img\",{src:picture,id:picture}),/*#__PURE__*/React.createElement(\"label\",{htmlFor:picture},idx));}),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",id:\"vote\",onChange:updateVote,ref:inputRef}),/*#__PURE__*/React.createElement(\"button\",{id:\"done\",onClick:submitVote},\"Done1\"),resultTime?/*#__PURE__*/React.createElement(Redirect,{to:{pathname:'/result',state:{code:code,name:name,groupSize:groupSize,round:round}}}):null,\"}\");}export default Vote;","map":{"version":3,"sources":["/Users/jacklunceford/Desktop/quiplash_drawing_game/react-app/src/pages/vote.jsx"],"names":["React","useRef","useEffect","useState","socket","firebase","Vote","props","code","location","state","name","pictures","setPictures","round","resultTime","setResultTime","groupSize","vote","setVote","inputRef","db","firestore","collection","where","get","then","querySnapshot","docs","forEach","doc","concat","data","dataURL","numVotes","on","interval","setInterval","setTime","time","clearInterval","updateVote","event","target","value","submitVote","votedPicture","update","votes","FieldValue","increment","artist","emit","getWord","word","map","idx","picture","pathname"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\nimport socket from \"../socketConfig\";\nimport firebase from '../firebase.js';\n\nfunction Vote(props) {\n  const code = useState(props.location.state.code);\n  const name = useState(props.location.state.name);\n  const [pictures, setPictures] = useState([]);\n  const round = useState(props.location.state.round);\n  const [resultTime, setResultTime] = useState(false);\n  const groupSize = useState(props.location.state.groupSize);\n  const [vote, setVote] = useState();\n  const inputRef = useRef(null);\n\n  useEffect(() => {\n    const db = firebase.firestore();\n    db.collection(\"rooms\").where(\"code\", \"==\", this.state.code).collection(\"rounds\").where(\"round\", \"==\", round).collection(\"pictures\").get().then((querySnapshot) => {\n        querySnapshot.docs.forEach((doc) => {\n            setPictures(pictures => pictures.concat(doc.data().dataURL));\n        });\n    });\n    let numVotes = 0;\n    socket.on(\"vote\", () => {\n        numVotes ++;\n        if (numVotes == groupSize) {\n            setResultTime(true);\n        }\n    });\n    const interval = setInterval(() => {\n        setTime( time => time - 1);\n        if (time == 0) {\n            clearInterval(interval);\n            setResultTime(true);\n        }\n    }, 1000);\n}, []);\n\n  updateVote = (event) => {\n      setVote({vote: event.target.value});\n  }\n\n  submitVote = () => {\n      let votedPicture = pictures[vote];\n      const db = firebase.firestore();\n      db.collection(\"rooms\").where(\"code\", \"==\", code).collection(\"rounds\").where(\"round\", \"==\", round).collection(\"pictures\").where(\"dataURL\", \"==\", votedPicture).update({\n          votes : firebase.firestore.FieldValue.increment(1)\n      }).then(() => {\n        db.collection(\"rooms\").where(\"code\", \"==\", code).collection(\"rounds\").where(\"round\", \"==\", round).collection(\"pictures\").where(\"dataURL\", \"==\", votedPicture).get().then((doc) => {\n            db.collection(\"rooms\").where(\"code\", \"==\", code).collection(\"players\").where(\"name\", \"==\", doc.data().artist).update({\n                votes : firebase.firestore.FieldValue.increment(1)\n            }).then(() => {\n                socket.emit(\"vote\", code);\n            });\n        });\n    });\n}\n\n  getWord = () => {\n      const db = firebase.firestore();\n      db.collection(\"rooms\").where(\"code\", \"==\", code).collection(\"rounds\").where(\"round\", \"==\", round).get().then((doc) => {\n          return doc.data().word;\n      });\n  }\n\n  return (\n    <div>\n        <h1>{getWord}</h1>\n        {pictures.map((idx, picture) => {\n            return (<div>\n                        <img src={picture} id={picture}/>\n                        <label htmlFor={picture}>{idx}</label>\n                    </div>)\n                        })}\n        <input type=\"text\" id=\"vote\" onChange={updateVote} ref={inputRef}/>\n        <button id=\"done\" onClick={submitVote}>Done1</button>\n        {resultTime ? <Redirect to={{pathname: '/result', state: {code: code, name: name, groupSize: groupSize, round: round}}}/> : null }}\n    </div>\n    );\n}\n\nexport default Vote;"]},"metadata":{},"sourceType":"module"}